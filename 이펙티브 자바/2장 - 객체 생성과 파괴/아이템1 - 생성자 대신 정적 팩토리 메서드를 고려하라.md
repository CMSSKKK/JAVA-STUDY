# 이펙티브 자바

> 이펙티브 자바 3/E  - 조슈아 블로크  (이복연 옮김) 읽고 요약하였음.

## 2장 : 객체 생성과 파괴

### 아이템1 - 생성자 대신 정적 팩토리 메서드를 고려하라

```java
public static Boolean valueOf(boolean b) {
  return b ? Boolean.TRUE : Boolean.FALSE;
}
```

> boolean의 박싱 클래스인 Boolean의 간단한 코드
>
> 기본 타입인 boolean 값을 받아 Boolean 객체 참조로 변환해주는 메서드

#### 장점 1 : 이름을 가질 수 있다.

* 한 클래스에서 생성자가 여러 개 필요할 것 같으면, 생성자를 정적 팩터리 메서드로 바꾸고 각각의 차이를 잘 드러내는 이름을 지어주는 방식을 고려하자.

#### 장점 2 : 호출될 때마다 인스턴스를 새로 생성하지는 않아도 된다.

* 불변 클래스의 경우 인스턴스를 미리 만들어두거나, 새로 생성한 인스턴스를 캐싱하여 재활용하는 식으로 불필요한 객체 생성을 피한다.
* 같은 객체가 자주 요청되는 상황이라면 성능을 상당히 끌어올려준다.
* 플라이웨이트 패턴과 비슷한 기법
* 인스턴스 통제 클래스(아이템3,4,17)

#### 장점 3 : 반환 타입의 하위 타입 객체를 반환할 수 있는 능력이 있다.

* 반환할 객체의 클래스를 자유롭게 선택할 수 있게하는 '유연성'을 선물한다.
* 자바 8부터 인터페이스에 public static(정적 메서드)를 선언할 수 있게 되었다. -> 동반 클래스에 두었던 정적 멤버들 상당수를 인터페이스 자체에 둘 수 있게 되었다.

#### 장점 4 : 입력 매개변수에 따라 매번 다른 클래스의 객체를 반환할 수 있다

* 반환 타입의 하위 타입이기만 하면 어떤 클래스의 객체를 반환하든 상관없다. 
* EnumSet클래스는 정적 팩토리만 제공하는데 원소의 수에 따라서 하위 클래스 중 하나의 인스턴스를 반환한다 -> 클라이언트는 인스턴스의 클래스를 모를뿐더러, 알 필요도 없다.

### 장점 5 : 정적 팩터리 메서들 작성하는 시점에는 반환할 객체의 클래스가 존재하지 않아도 된다.

* 서비스 제공자 프레임워크의 근간이 된다.
* 대표적 서비스 제공자 프레임워크는 JDBC
* 서비스 제공자 프레임워크의 핵심 컴포넌트 3개
  * 서비스 인터페이스
  * 제공자 등록 API
  * 서비스 접근 API
* 서비스 접근 API가 '유연한 정적 팩터리'의 실체
* 서비스 제공자 인터페이스는 4번째 컴포넌트로 쓰이기도 한다. 이 컴포넌트는 서비스 인터페이스의 인스턴스를 생성하는 팩터리 객체를 설명해준다.

> 서비스 제공자 프레임워크에 대한 이해가 없어서 정리만 해둔다.
>
> 의존성 주입과 비슷한 맥락의 개념으로도 볼 수 있다.

#### 단점 1 : 상속을 하려면 public이나 protected 생성자가 필요하니 정적 팩터리 메서드만 제공하면 하위 클래스를 만들 수 없다.

* 컬렉션 프레임워크의 유틸리티 구현 클래스들은 상속할 수 없다.
* 이러한 제약은 오히려 장점으로 받아들일 수 있다.

#### 단점 2 : 정적 팩터리 메서드는 프로그래머가 찾기 어렵다.

* 생성자와 같이 API 설명에 명확히 드러나지 않아서 따로 문서화하고 메서드 이름도 규약에 맞춰서 문제를 완화해야한다.



#### 메서드 규약

* `from`: 매개변수를 하나 받아서 해당 타입의 인스턴스를 반환하는 형변환 메서드

* `of`: 여러 매개변수를 받아 적합한 타입의 인스턴스를 반환하는 집계 메서드

* `valueOf`: from과 of의 더 자세한 버전

* `instance` 혹은 `getInstance`: (매개변수를 받는다면) 매개변수로 명시한 인스턴스를 반환하지만, 같은 인스턴스임을 보장하지는 않는다. 

* `create`혹은 `newInstance`: 매번 새로운 인스턴스를 생성해 반환함을 보장한다.

* `getType`: `getInstance`와 같지만, 생성한 클래스가 아닌 다른 클래스에 팩터리 메서드를 정의할 때 쓴다. 

> ` FileStore fs = Files.getFileStore(path);`

* `newType` : `newInstance`와 같지만, 생성한 클래스가 아닌 다른 클래스에 팩터리 메서드를 정의할 때 쓴다. 
* `Type`: `getType`, `newType`의 간결한 버전



> 핵심 정리 
>
> 무작정 public 생성자를 제공하던 습관이 있다면 고치자.